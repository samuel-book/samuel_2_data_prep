

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Disability at six month follow up &#8212; SAMueL-2 Descriptive Analysis</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'disability_6_months';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Ambulance" href="ambulance.html" />
    <link rel="prev" title="Thrombectomy" href="thrombectomy.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    <p class="title logo__title">SAMueL-2 Descriptive Analysis</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Descriptive analysis
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01_reformat_data.html">Reformat data</a></li>
<li class="toctree-l1"><a class="reference internal" href="sam1_pathway_statistics.html">Descriptive analysis of stroke pathway data</a></li>
<li class="toctree-l1"><a class="reference internal" href="sam1_thrombolysis_associations.html">Association between patient features and thrombolysis use</a></li>
<li class="toctree-l1"><a class="reference internal" href="sam1_compare_by_thrombolysis.html">Comparison between patients who received thrombolysis versus not</a></li>
<li class="toctree-l1"><a class="reference internal" href="sam1_day_week_pathway_patterns.html">Daily and weekly pathway patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="sam1_pathway_distributions.html">Stroke pathway timing distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="sam1_correlations.html">Covariance/correlation between features</a></li>
<li class="toctree-l1"><a class="reference internal" href="thrombectomy.html">Thrombectomy</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Disability at six month follow up</a></li>
<li class="toctree-l1"><a class="reference internal" href="ambulance.html">Ambulance</a></li>
<li class="toctree-l1"><a class="reference internal" href="compare_years.html">Year by year comparison</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fdisability_6_months.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/disability_6_months.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Disability at six month follow up</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aims">Aims</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up">Set up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive">Descriptive</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#completion">Completion</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filter-to-alive-at-discharge">Filter to alive at discharge</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-patients-followed-up-with-those-not">Comparing patients followed up with those not</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#change-in-disability-between-discharge-and-6-month-follow-up">Change in disability between discharge and 6-month follow-up</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-change-in-disability">Regression (change in disability)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset">Dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transform-data-fit-model-and-collect-evaluation-metrics">Transform data, fit model, and collect evaluation metrics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#review-results">Review results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#standardised-results">Standardised results</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#unstandardised-results">Unstandardised results</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#assumptions">Assumptions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-whether-have-follow-up-appointment">Regression (whether have follow-up appointment)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Dataset</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="tex2jax_ignore mathjax_ignore section" id="disability-at-six-month-follow-up">
<h1>Disability at six month follow up<a class="headerlink" href="#disability-at-six-month-follow-up" title="Permalink to this headline">#</a></h1>
<div class="section" id="aims">
<h2>Aims<a class="headerlink" href="#aims" title="Permalink to this headline">#</a></h2>
<p>Note: data on disability at six month follow up is not missing at random.</p>
<p>Investigating factors that relate to:</p>
<ul class="simple">
<li><p>Whether patients have a record of disability at six months</p></li>
<li><p>Patients disability score/change in disability between discharge and follow up</p></li>
</ul>
</div>
<div class="section" id="set-up">
<h2>Set up<a class="headerlink" href="#set-up" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import packages and functions</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">KFold</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="p">(</span><span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span>
                             <span class="n">r2_score</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">)</span>

<span class="c1"># Set max rows when display dataframe</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># Linting</span>
<span class="o">%</span><span class="k">load_ext</span> pycodestyle_magic
<span class="o">%</span><span class="k">pycodestyle_on</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set paths and filenames</span>
<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Paths</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Singleton object for storing paths to data and files.&#39;&#39;&#39;</span>

    <span class="n">data_path</span> <span class="o">=</span> <span class="s1">&#39;./../output/&#39;</span>
    <span class="n">data_filename</span> <span class="o">=</span> <span class="s1">&#39;reformatted_data.csv&#39;</span>
    <span class="n">admission_only_filename</span> <span class="o">=</span> <span class="s1">&#39;reformatted_data_admissions_only.csv&#39;</span>


<span class="n">paths</span> <span class="o">=</span> <span class="n">Paths</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span>
                                <span class="n">paths</span><span class="o">.</span><span class="n">data_filename</span><span class="p">))</span>
<span class="n">data_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paths</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span>
                                     <span class="n">paths</span><span class="o">.</span><span class="n">admission_only_filename</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="descriptive">
<h2>Descriptive<a class="headerlink" href="#descriptive" title="Permalink to this headline">#</a></h2>
<div class="section" id="completion">
<h3>Completion<a class="headerlink" href="#completion" title="Permalink to this headline">#</a></h3>
<p>This section summarises the completion rate for disability scores at each timepoint. As we would anticipate, no-one marked as having died (which we understand to mean they were not discharged following arrival as they died), has a 6-month follow-up. Hence, summaries of completion are repeated, but for individuals who were alive at discharge.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">count_missing</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Find count and proportion of people missing disability at each timepoint</span>
<span class="sd">    df: pandas dataframe</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Mark whether disability is present at each timepoint or not</span>
    <span class="n">mrs_missing</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;prior_disability&#39;</span><span class="p">,</span>
            <span class="s1">&#39;discharge_disability&#39;</span><span class="p">,</span>
            <span class="s1">&#39;disability_6_month&#39;</span><span class="p">]]</span>
        <span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
        <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="kc">True</span><span class="p">:</span> <span class="s1">&#39;Missing&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">:</span> <span class="s1">&#39;Not missing&#39;</span><span class="p">})))</span>

    <span class="c1"># Count patterns of missing or not between variables</span>
    <span class="n">mrs_complete</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">mrs_missing</span>
        <span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;disability_6_month&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="c1"># Convert counts to proportions and display results</span>
    <span class="n">mrs_complete</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">mrs_complete</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">mrs_complete</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">*</span><span class="mi">100</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Completion of disability data:&#39;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">mrs_complete</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">mrs_missing</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">disability_known_death</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Add columns indicating whether disability at 6 months was known</span>
<span class="sd">    (and return dataframe with that column added). Print the relationship</span>
<span class="sd">    between death and disability at 6 months (should see no individuals</span>
<span class="sd">    who died have follow-up)</span>
<span class="sd">    df: pandas dataframe</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Add column indicating whether disability at 6 months was known</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;disability_6_month_known&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;disability_6_month&#39;</span><span class="p">]</span>
        <span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
        <span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="kc">True</span><span class="p">:</span> <span class="s1">&#39;No (missing)&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">:</span> <span class="s1">&#39;Yes (present)&#39;</span><span class="p">}))</span>

    <span class="c1"># View relationship between death and 6 month follow up</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">See no individuals who died had follow-up:&#39;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span>
            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;disability_6_month_known&#39;</span><span class="p">)[</span><span class="s1">&#39;death&#39;</span><span class="p">]</span>
            <span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">df</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">count_alive_missing</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">mrs_missing</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Find count and proportion of people missing disability at each timepoint</span>
<span class="sd">    Focussing only on individuals who were alive at discharge</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Add death</span>
    <span class="n">mrs_missing</span><span class="p">[</span><span class="s1">&#39;death&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;death&#39;</span><span class="p">]</span>

    <span class="c1"># Count proportion missing data</span>
    <span class="n">mrs_complete_alive</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">mrs_missing</span><span class="p">[</span><span class="n">mrs_missing</span><span class="p">[</span><span class="s1">&#39;death&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;disability_6_month&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
    <span class="n">mrs_complete_alive</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">mrs_complete_alive</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">mrs_complete_alive</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">*</span><span class="mi">100</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Completion of disability data (for patients alive at discharge):&#39;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">mrs_complete_alive</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Observations:</strong> For patients arriving within 4 hours of known onset who were alive at discharge, 34.5% have data on disability at 6 months, 64.6% are missing it, and 0.9% are missing discharge and 6-month disability.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For patients who arrive within four hours of known onset...&#39;</span><span class="p">)</span>
<span class="n">mrs_missing_data</span> <span class="o">=</span> <span class="n">count_missing</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">disability_known_death</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">count_alive_missing</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mrs_missing_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>For patients who arrive within four hours of known onset...

Completion of disability data:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>prior_disability</th>
      <th>discharge_disability</th>
      <th>disability_6_month</th>
      <th>count</th>
      <th>percentage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Not missing</td>
      <td>Not missing</td>
      <td>Not missing</td>
      <td>39167</td>
      <td>28.585087</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Not missing</td>
      <td>Not missing</td>
      <td>Missing</td>
      <td>96845</td>
      <td>70.679979</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Not missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>1007</td>
      <td>0.734935</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>See no individuals who died had follow-up:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>disability_6_month_known</th>
      <th>death</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>No (missing)</td>
      <td>0.0</td>
      <td>74322</td>
    </tr>
    <tr>
      <th>1</th>
      <td>No (missing)</td>
      <td>1.0</td>
      <td>23526</td>
    </tr>
    <tr>
      <th>2</th>
      <td>No (missing)</td>
      <td>NaN</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Yes (present)</td>
      <td>0.0</td>
      <td>39167</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completion of disability data (for patients alive at discharge):
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>prior_disability</th>
      <th>discharge_disability</th>
      <th>disability_6_month</th>
      <th>death</th>
      <th>count</th>
      <th>percentage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Not missing</td>
      <td>Not missing</td>
      <td>Not missing</td>
      <td>0.0</td>
      <td>39167</td>
      <td>34.511715</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Not missing</td>
      <td>Not missing</td>
      <td>Missing</td>
      <td>0.0</td>
      <td>73320</td>
      <td>64.605380</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Not missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>0.0</td>
      <td>1002</td>
      <td>0.882905</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For all patients...&#39;</span><span class="p">)</span>
<span class="n">mrs_missing_data_full</span> <span class="o">=</span> <span class="n">count_missing</span><span class="p">(</span><span class="n">data_full</span><span class="p">)</span>
<span class="n">data_full</span> <span class="o">=</span> <span class="n">disability_known_death</span><span class="p">(</span><span class="n">data_full</span><span class="p">)</span>
<span class="n">count_alive_missing</span><span class="p">(</span><span class="n">data_full</span><span class="p">,</span> <span class="n">mrs_missing_data_full</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>For all patients...

Completion of disability data:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>prior_disability</th>
      <th>discharge_disability</th>
      <th>disability_6_month</th>
      <th>count</th>
      <th>percentage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Not missing</td>
      <td>Not missing</td>
      <td>Not missing</td>
      <td>109321</td>
      <td>30.461375</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Not missing</td>
      <td>Not missing</td>
      <td>Missing</td>
      <td>247034</td>
      <td>68.833941</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Not missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>2529</td>
      <td>0.704685</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>See no individuals who died had follow-up:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>disability_6_month_known</th>
      <th>death</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>No (missing)</td>
      <td>0.0</td>
      <td>199725</td>
    </tr>
    <tr>
      <th>1</th>
      <td>No (missing)</td>
      <td>1.0</td>
      <td>49828</td>
    </tr>
    <tr>
      <th>2</th>
      <td>No (missing)</td>
      <td>NaN</td>
      <td>10</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Yes (present)</td>
      <td>0.0</td>
      <td>109321</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Completion of disability data (for patients alive at discharge):
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>prior_disability</th>
      <th>discharge_disability</th>
      <th>disability_6_month</th>
      <th>death</th>
      <th>count</th>
      <th>percentage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Not missing</td>
      <td>Not missing</td>
      <td>Not missing</td>
      <td>0.0</td>
      <td>109321</td>
      <td>35.373698</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Not missing</td>
      <td>Not missing</td>
      <td>Missing</td>
      <td>0.0</td>
      <td>197208</td>
      <td>63.811860</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Not missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>0.0</td>
      <td>2517</td>
      <td>0.814442</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="filter-to-alive-at-discharge">
<h3>Filter to alive at discharge<a class="headerlink" href="#filter-to-alive-at-discharge" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># All patients</span>
<span class="n">data_full_alive</span> <span class="o">=</span> <span class="n">data_full</span><span class="p">[</span><span class="n">data_full</span><span class="p">[</span><span class="s1">&#39;death&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
<span class="c1"># Patients who arrive within four hours of known onset</span>
<span class="n">data_alive</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;death&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="comparing-patients-followed-up-with-those-not">
<h3>Comparing patients followed up with those not<a class="headerlink" href="#comparing-patients-followed-up-with-those-not" title="Permalink to this headline">#</a></h3>
<p><strong>Observations:</strong></p>
<p><strong>Stroke severity:</strong> We see a marked difference in stroke severity, but not when only focus on those alive at discharge. In those alive at discharge, we see perhaps a smaller difference than might have anticipated - mean stroke severity 7.04 (not followed up) and 7.00 (followed up).</p>
<p><strong>Thrombolysed:</strong> Regardless of whether alive at discharge, we see a higher proportion who were thrombolysed have follow-up. This is less so when focus on all patients, and more so when focus on patients who arrived within 4 hours of known stroke onset. For example, in patients arriving within 4 hours of known onset and alive at discharge, 36.2% thrombolysed have follow-up v.s. 33.8% of those not thrombolysed. However, it has been commented that this difference may be smaller than anticipated, based on previous conversations/anecdotes about follow-up.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compare_follow_up</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Compare those with follow-up to those not in terms of:</span>
<span class="sd">    - Stroke severity</span>
<span class="sd">    - Whether they were thrombolysed</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Stroke severity</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stroke severity in those followed up v.s. not&#39;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span>
            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;disability_6_month_known&#39;</span><span class="p">)[</span><span class="s1">&#39;stroke_severity&#39;</span><span class="p">]</span>
            <span class="o">.</span><span class="n">describe</span><span class="p">())</span>

    <span class="c1"># Thrombolysis</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Proportion followed up in those thrombolysed v.s. not&#39;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span>
            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;thrombolysis&#39;</span><span class="p">)[</span><span class="s1">&#39;disability_6_month_known&#39;</span><span class="p">]</span>
            <span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;proportion&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For patients who arrived within 4 hours of known stroke onset...&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All patients (inc. dead at discharge):&#39;</span><span class="p">)</span>
<span class="n">compare_follow_up</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Patients who were alive at discharge:&#39;</span><span class="p">)</span>
<span class="n">compare_follow_up</span><span class="p">(</span><span class="n">data_alive</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>For patients who arrived within 4 hours of known stroke onset...
All patients (inc. dead at discharge):
Stroke severity in those followed up v.s. not
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>disability_6_month_known</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>No (missing)</th>
      <td>97852.0</td>
      <td>9.689889</td>
      <td>8.756325</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>6.0</td>
      <td>15.0</td>
      <td>42.0</td>
    </tr>
    <tr>
      <th>Yes (present)</th>
      <td>39167.0</td>
      <td>6.995940</td>
      <td>6.499562</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>10.0</td>
      <td>42.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Proportion followed up in those thrombolysed v.s. not
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>thrombolysis</th>
      <th>disability_6_month_known</th>
      <th>proportion</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>No (missing)</td>
      <td>0.725331</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>Yes (present)</td>
      <td>0.274669</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>No (missing)</td>
      <td>0.687080</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>Yes (present)</td>
      <td>0.312920</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Patients who were alive at discharge:
Stroke severity in those followed up v.s. not
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>disability_6_month_known</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>No (missing)</th>
      <td>74322.0</td>
      <td>7.040728</td>
      <td>6.637187</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>10.0</td>
      <td>42.0</td>
    </tr>
    <tr>
      <th>Yes (present)</th>
      <td>39167.0</td>
      <td>6.995940</td>
      <td>6.499562</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>10.0</td>
      <td>42.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Proportion followed up in those thrombolysed v.s. not
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>thrombolysis</th>
      <th>disability_6_month_known</th>
      <th>proportion</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>No (missing)</td>
      <td>0.662091</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>Yes (present)</td>
      <td>0.337909</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>No (missing)</td>
      <td>0.638498</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>Yes (present)</td>
      <td>0.361502</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For all patients (including those who were dead at discharge):&#39;</span><span class="p">)</span>
<span class="n">compare_follow_up</span><span class="p">(</span><span class="n">data_full</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For all patients who were alive at discharge:&#39;</span><span class="p">)</span>
<span class="n">compare_follow_up</span><span class="p">(</span><span class="n">data_full_alive</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>For all patients (including those who were dead at discharge):
Stroke severity in those followed up v.s. not
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>disability_6_month_known</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>No (missing)</th>
      <td>249563.0</td>
      <td>7.802042</td>
      <td>8.299545</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>11.0</td>
      <td>42.0</td>
    </tr>
    <tr>
      <th>Yes (present)</th>
      <td>109321.0</td>
      <td>5.370002</td>
      <td>5.683979</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>7.0</td>
      <td>42.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Proportion followed up in those thrombolysed v.s. not
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>thrombolysis</th>
      <th>disability_6_month_known</th>
      <th>proportion</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>No (missing)</td>
      <td>0.696475</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>Yes (present)</td>
      <td>0.303525</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>No (missing)</td>
      <td>0.686979</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>Yes (present)</td>
      <td>0.313021</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>For all patients who were alive at discharge:
Stroke severity in those followed up v.s. not
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>disability_6_month_known</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>No (missing)</th>
      <td>199725.0</td>
      <td>5.511238</td>
      <td>5.949742</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>7.0</td>
      <td>42.0</td>
    </tr>
    <tr>
      <th>Yes (present)</th>
      <td>109321.0</td>
      <td>5.370002</td>
      <td>5.683979</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>7.0</td>
      <td>42.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Proportion followed up in those thrombolysed v.s. not
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>thrombolysis</th>
      <th>disability_6_month_known</th>
      <th>proportion</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>No (missing)</td>
      <td>0.647322</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>Yes (present)</td>
      <td>0.352678</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>No (missing)</td>
      <td>0.638126</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>Yes (present)</td>
      <td>0.361874</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="change-in-disability-between-discharge-and-6-month-follow-up">
<h3>Change in disability between discharge and 6-month follow-up<a class="headerlink" href="#change-in-disability-between-discharge-and-6-month-follow-up" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">disability_change</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="c1"># Change in mRS score from discharge to 6 months later</span>
    <span class="n">mrs_6m</span> <span class="o">=</span> <span class="p">((</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;disability_6_month&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;discharge_disability&#39;</span><span class="p">])</span>
              <span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&#39;&#39;From discharge to 6 months later, the mean change in</span>
<span class="s1">    Modified Rankin Scale score is </span><span class="si">{</span><span class="n">mrs_6m</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">mrs_6m</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plot_disability_change</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="c1"># Extract individuals with complete data at followup</span>
    <span class="n">mrs_compare</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;disability_6_month&#39;</span><span class="p">,</span> <span class="s1">&#39;discharge_disability&#39;</span><span class="p">]]</span>
                   <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
                   <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;disability_6_month&#39;</span><span class="p">:</span> <span class="s1">&#39;followup&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;discharge_disability&#39;</span><span class="p">:</span> <span class="s1">&#39;discharge&#39;</span><span class="p">}))</span>

    <span class="c1"># Compare 6 month disability to discharge disability</span>
    <span class="n">mrs_compare</span><span class="p">[</span><span class="s1">&#39;compare&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">mrs_compare</span><span class="p">[</span><span class="s1">&#39;followup&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">mrs_compare</span><span class="p">[</span><span class="s1">&#39;discharge&#39;</span><span class="p">],</span> <span class="s1">&#39;Worse&#39;</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mrs_compare</span><span class="p">[</span><span class="s1">&#39;followup&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">mrs_compare</span><span class="p">[</span><span class="s1">&#39;discharge&#39;</span><span class="p">],</span>
                 <span class="s1">&#39;Better&#39;</span><span class="p">,</span> <span class="s1">&#39;Same&#39;</span><span class="p">))</span>

    <span class="c1"># Find proportion better, same or worse - by discharge disability</span>
    <span class="n">mrs_compare_3</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">mrs_compare</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;discharge&#39;</span><span class="p">)[</span><span class="s1">&#39;compare&#39;</span><span class="p">]</span>
        <span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;prop&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;discharge&#39;</span><span class="p">,</span> <span class="s1">&#39;compare&#39;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;discharge&#39;</span><span class="p">,</span>
               <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;compare&#39;</span><span class="p">,</span>
               <span class="n">values</span><span class="o">=</span><span class="s1">&#39;prop&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

    <span class="c1"># Plot these results</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">mrs_compare_3</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Discharge disability&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Proportion of patients&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Disability at 6 months (compared to discharge)&#39;</span><span class="p">,</span>
              <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;For each discharge mRS score, proportion of patients&#39;</span> <span class="o">+</span>
                 <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">who had better, same or worse score at 6-month follow-up&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">plot_follow_up_by_discharge</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="c1"># Find proportion with each disability at 6 months,</span>
    <span class="c1"># grouped by discharge disability</span>
    <span class="n">followup</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span>
                <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;discharge_disability&#39;</span><span class="p">)[</span><span class="s1">&#39;disability_6_month&#39;</span><span class="p">]</span>
                <span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;prop&#39;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;discharge_disability&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;disability_6_month&#39;</span><span class="p">]))</span>

    <span class="c1"># Pivot those results so they&#39;re suitable for plot</span>
    <span class="n">followup_p</span> <span class="o">=</span> <span class="p">(</span><span class="n">followup</span>
                  <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
                  <span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;disability_6_month&#39;</span><span class="p">,</span>
                         <span class="n">index</span><span class="o">=</span><span class="s1">&#39;discharge_disability&#39;</span><span class="p">,</span>
                         <span class="n">values</span><span class="o">=</span><span class="s1">&#39;prop&#39;</span><span class="p">))</span>

    <span class="c1"># Create plot (line plot as easier to see difference in proportions)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">followup_p</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Disability at 6-month follow-up (mRS score)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Proportion of patients&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_lines</span><span class="p">(),</span> <span class="n">followup_p</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span>
              <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Discharge disability&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Proportion of patients with each 6-month disability score&#39;</span> <span class="o">+</span>
                 <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">(grouped by their discharge disability score)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Observations:</strong></p>
<ul class="simple">
<li><p>We see that Rankin score from discharge to follow-up is, on average, the <strong>same</strong> (median) or <strong>worse</strong> (mean) (focussing only on people who have measurements at both time points). This is contrary to a comment received, that we would expect people to, on average, be 1 unit better.</p></li>
<li><p>Majority of patients with discharge score of 0 or 5 are worse</p></li>
<li><p>Majority of patients with discharge score of 2, 3, or 4 are better</p></li>
</ul>
<p>Caveats include:</p>
<ul class="simple">
<li><p>Data is not missing at random</p></li>
<li><p>mRS is an ordinal scale (i.e. they have an order but there is not a consistent space on the scale between each score) (hence why some of the other analyses on SAMueL2 use utility values)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For patients with disability at discharge and 6 months&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;who had arrived within 4 hours of known stroke onset...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">disability_change</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">plot_disability_change</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">plot_follow_up_by_discharge</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>For patients with disability at discharge and 6 months
who had arrived within 4 hours of known stroke onset...

From discharge to 6 months later, the mean change in
    Modified Rankin Scale score is 0.1
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    39167.000000
mean         0.101182
std          1.516493
min         -5.000000
25%         -1.000000
50%          0.000000
75%          1.000000
max          6.000000
dtype: float64
</pre></div>
</div>
<img alt="_images/c3129324701735e806ffa66d199791870e4891ef4624ddc46a0a160fa42f0061.png" src="_images/c3129324701735e806ffa66d199791870e4891ef4624ddc46a0a160fa42f0061.png" />
<img alt="_images/00c10bf665933f143690826677f04f74a5f3b74023fae91f120e087d212bf179.png" src="_images/00c10bf665933f143690826677f04f74a5f3b74023fae91f120e087d212bf179.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For all patients with scores at both times...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">disability_change</span><span class="p">(</span><span class="n">data_full</span><span class="p">)</span>
<span class="n">plot_disability_change</span><span class="p">(</span><span class="n">data_full</span><span class="p">)</span>
<span class="n">plot_follow_up_by_discharge</span><span class="p">(</span><span class="n">data_full</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>For all patients with scores at both times...

From discharge to 6 months later, the mean change in
    Modified Rankin Scale score is 0.1
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    109321.00000
mean          0.11533
std           1.52376
min          -5.00000
25%          -1.00000
50%           0.00000
75%           1.00000
max           6.00000
dtype: float64
</pre></div>
</div>
<img alt="_images/f229b2b0fd3da71d25d5cd93e2a0b7ccadb0bda82f745d7471e25e4bac2253ac.png" src="_images/f229b2b0fd3da71d25d5cd93e2a0b7ccadb0bda82f745d7471e25e4bac2253ac.png" />
<img alt="_images/e581437f0fba6623ba19a20e4dcc47fd6c783270d854fe7ca491c40a366845af.png" src="_images/e581437f0fba6623ba19a20e4dcc47fd6c783270d854fe7ca491c40a366845af.png" />
</div>
</div>
</div>
</div>
<div class="section" id="regression-change-in-disability">
<h2>Regression (change in disability)<a class="headerlink" href="#regression-change-in-disability" title="Permalink to this headline">#</a></h2>
<p>Multiple linear regression model, with estimation using ordinary least squares (OLS).</p>
<p>Caveat:</p>
<ul class="simple">
<li><p>Data is not missing at random</p></li>
<li><p>mRS score is ordinal scale</p></li>
</ul>
<div class="section" id="dataset">
<h3>Dataset<a class="headerlink" href="#dataset" title="Permalink to this headline">#</a></h3>
<p>The dataset is patients who arrived within 4 hours of known onset, and who have complete data at each disability timepoint, as well as for stroke severity, age and whether thrombolysed.</p>
<p>In those model, we are predicting change in disability from discharge to six month follow up.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract relevant columns and drop rows with NA</span>
<span class="n">reg_df</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;prior_disability&#39;</span><span class="p">,</span> <span class="s1">&#39;stroke_severity&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span>
               <span class="s1">&#39;thrombolysis&#39;</span><span class="p">,</span> <span class="s1">&#39;discharge_disability&#39;</span><span class="p">,</span>
               <span class="s1">&#39;disability_6_month&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">reg_df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Define predictor and response variables</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">reg_df</span><span class="p">[[</span><span class="s1">&#39;prior_disability&#39;</span><span class="p">,</span> <span class="s1">&#39;stroke_severity&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span>
            <span class="s1">&#39;thrombolysis&#39;</span><span class="p">,</span> <span class="s1">&#39;discharge_disability&#39;</span><span class="p">]]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">reg_df</span><span class="p">[</span><span class="s1">&#39;disability_6_month&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">reg_df</span><span class="p">[</span><span class="s1">&#39;discharge_disability&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(39167, 7)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="transform-data-fit-model-and-collect-evaluation-metrics">
<h3>Transform data, fit model, and collect evaluation metrics<a class="headerlink" href="#transform-data-fit-model-and-collect-evaluation-metrics" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">standardise_data</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Put features on a similar scale through standardisation.</span>
<span class="sd">    Just transforms features (not response/target variable).</span>
<span class="sd">    Invovles subtracting mean and dividing by standard deviation (SD)</span>
<span class="sd">    of each feature, so data have mean of 0 and SD of 1.</span>
<span class="sd">    Test data is standardised on training data mean and SD.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Set up scaling object and fit on training data</span>
    <span class="n">sc</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

    <span class="c1"># Apply scaling to training and test data</span>
    <span class="n">train_std</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">test_std</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">train_std</span><span class="p">,</span> <span class="n">test_std</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_regression</span><span class="p">(</span><span class="n">standardise</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Run regression with 5-fold cross-validation</span>
<span class="sd">    Can choose whether to standardise input variables or not</span>
<span class="sd">    Returns MAE, MSE, RMSE, R2, adjusted R2, feature weights and residuals</span>
<span class="sd">    standardise: True or False</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Set up to create five training/test data splits</span>
    <span class="n">kfold</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Create empty dictionary to store results</span>
    <span class="c1"># (defaultdict so don&#39;t have to pre-define keys)</span>
    <span class="n">reg_results</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># Use loop to test model on those five different splits</span>
    <span class="k">for</span> <span class="n">train_row</span><span class="p">,</span> <span class="n">test_row</span> <span class="ow">in</span> <span class="n">kfold</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
        <span class="c1"># Split into training and test data</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_row</span><span class="p">],</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_row</span><span class="p">]</span>
        <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">train_row</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">test_row</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">standardise</span><span class="p">:</span>
            <span class="c1"># Standardise X data</span>
            <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">standardise_data</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">)</span>

        <span class="c1"># Set up and fit multiple linear regression</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

        <span class="c1"># Get feature weights</span>
        <span class="n">reg_results</span><span class="p">[</span><span class="s1">&#39;feature_weights&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>

        <span class="c1"># Predict y values using the x test values</span>
        <span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

        <span class="c1"># Find residuals (difference between prediction and actual)</span>
        <span class="n">resid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;actual&#39;</span><span class="p">:</span> <span class="n">y_test</span><span class="p">,</span>
                              <span class="s1">&#39;pred&#39;</span><span class="p">:</span> <span class="n">y_test_pred</span><span class="p">})</span>
        <span class="n">resid</span><span class="p">[</span><span class="s1">&#39;residuals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">resid</span><span class="p">[</span><span class="s1">&#39;actual&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">resid</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">])</span>
        <span class="n">reg_results</span><span class="p">[</span><span class="s1">&#39;residuals&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resid</span><span class="p">)</span>

        <span class="c1"># Use predictions to calculate evaluation metrics</span>
        <span class="n">reg_results</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">))</span>
        <span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
        <span class="n">reg_results</span><span class="p">[</span><span class="s1">&#39;mse&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
        <span class="n">reg_results</span><span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">))</span>
        <span class="n">reg_results</span><span class="p">[</span><span class="s1">&#39;r2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">))</span>
        <span class="n">adjusted_r2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span>
                       <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">))</span> <span class="o">*</span>
                       <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span>
                       <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span><span class="o">-</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">reg_results</span><span class="p">[</span><span class="s1">&#39;adjusted_r2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adjusted_r2</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">reg_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run with X variables standardised</span>
<span class="n">reg_results</span> <span class="o">=</span> <span class="n">run_regression</span><span class="p">(</span><span class="n">standardise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Run without standardisation</span>
<span class="n">reg_results_non_std</span> <span class="o">=</span> <span class="n">run_regression</span><span class="p">(</span><span class="n">standardise</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="review-results">
<h3>Review results<a class="headerlink" href="#review-results" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">show_regression_results</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Summarise results from regression, based on results dictionary input</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Table of coefficients (as is, and absolute)</span>
    <span class="n">coef</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;feature_weights&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">mean_coef</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;coef&#39;</span><span class="p">:</span> <span class="n">coef</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                              <span class="s1">&#39;coef_abs&#39;</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">coef</span><span class="o">.</span><span class="n">mean</span><span class="p">())})</span>
    <span class="n">mean_coef_sort</span> <span class="o">=</span> <span class="n">mean_coef</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;coef_abs&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">mean_coef_sort</span><span class="p">)</span>

    <span class="c1"># Plot of feature weights</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">mean_coef_sort</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">mean_coef_sort</span><span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Feature&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Coefficient&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Metrics</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">          Average MAE: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">])</span><span class="si">:</span><span class="s1">.9f</span><span class="si">}</span><span class="s1"></span>
<span class="s1">          Average RMSE: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">])</span><span class="si">:</span><span class="s1">.9f</span><span class="si">}</span><span class="s1"></span>
<span class="s1">          Average R-squared: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;r2&#39;</span><span class="p">])</span><span class="si">:</span><span class="s1">.9f</span><span class="si">}</span><span class="s1"></span>
<span class="s1">          Average adjusted R-squared: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;adjusted_r2&#39;</span><span class="p">])</span><span class="si">:</span><span class="s1">.9f</span><span class="si">}</span><span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="standardised-results">
<h4>Standardised results<a class="headerlink" href="#standardised-results" title="Permalink to this headline">#</a></h4>
<p><strong>Understanding outcome score</strong></p>
<p>Outcome is change in disability score between discharge and six-month follow-up (disability_6_month - discharge_disability). <strong>A negative result means that score improved.</strong> A positive result means that the score worsened.</p>
<p><em>Example: Patient sees improvement. They have mRS 3 at discharge and mRS 2 at 6-month. Their outcome would be negative, as score has gone down (2 - 3 = -1).</em></p>
<p><strong>Interpreting the coefficients</strong></p>
<p>These are standardised - they are in units of standard deviation - and hence you can compare the relative importance of each variable, as they are on the same scale. Standardised coefficients reflect the change in outcome (in terms of standard deviation) for every increase of one standard deviation in the predictor.</p>
<ul class="simple">
<li><p><strong>Discharge disability</strong> and <strong>thrombolysis</strong> have negative coefficients. This means that having a higher discharge disability, and receiving thrombolysis, are associated with an <strong>improvement</strong> in disability between discharge and follow-up (a negative change in score).</p></li>
<li><p><strong>Prior disability</strong>, <strong>stroke severity</strong> and <strong>age</strong> have positive coefficients. This means that having a higher prior disability, higher stroke severity, and older age, are associated with a <strong>worsening</strong> in disability between discharge and follow-up (a positive change in score).</p></li>
<li><p>Discharge disability largest, so greatest relative importance.</p></li>
</ul>
<p><strong>Note:</strong> If you have a higher discharge disability, you have <strong>more scope to improve</strong> (e.g. mRS 5 can go down to mRS 1, but mRS 1 can change by a max of 1 to mRS 0). Hence, it is essentially an artefact of the scale and the scope to change. This analysis may therefore feel unhelpful - but should consider that it is still helpful in thinking through what is going on in the data.</p>
<p><strong>Interpreting the metrics</strong></p>
<ul class="simple">
<li><p><strong>MAE</strong>: Mean absolute error. Calculation is to find average of the residuals (which themselves are the difference between actual and predicted values). Lower value implies higher accuracy. Difficult to interpret as generally about comparing accuracy between models and depends on scale in dataset.</p></li>
<li><p><strong>RMSE</strong>: Square root of variance of residuals. Average distance between predicted and observed values. It shows absolute fit of model. Likewise hard to interpret without comparison.</p></li>
<li><p><strong>R-squared</strong>: Relatived fit of model. Also known as coefficient of multiple determination. Percentage of variance explained (variance explained by the model over the total variance). R squared of 17% means that model explains 17% of variation in response variable around the mean.</p></li>
<li><p><strong>Adjusted R-squared:</strong> Important in multiple regression. Issue with R-squared is that it increases with every predictor added to the model, so you may think you have a better fit, the more terms you add, which is misleading. Adjusted R-squared is adjusted for the number of independent variables in the model. It will increase if useful variables are added to the model and decrease if useless variables are added.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Standardised prior to regression</span>
<span class="n">show_regression_results</span><span class="p">(</span><span class="n">reg_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>coef_abs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>discharge_disability</th>
      <td>-0.754259</td>
      <td>0.754259</td>
    </tr>
    <tr>
      <th>prior_disability</th>
      <td>0.420169</td>
      <td>0.420169</td>
    </tr>
    <tr>
      <th>stroke_severity</th>
      <td>0.326516</td>
      <td>0.326516</td>
    </tr>
    <tr>
      <th>age</th>
      <td>0.193207</td>
      <td>0.193207</td>
    </tr>
    <tr>
      <th>thrombolysis</th>
      <td>-0.132672</td>
      <td>0.132672</td>
    </tr>
  </tbody>
</table>
</div></div><img alt="_images/8e5759b1711b666a6d19bac3b244dec303e0003c32026011cb509212731892b6.png" src="_images/8e5759b1711b666a6d19bac3b244dec303e0003c32026011cb509212731892b6.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          Average MAE: 1.048270786
          Average RMSE: 1.375681834
          Average R-squared: 0.177001223
          Average adjusted R-squared: 0.177233764
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="unstandardised-results">
<h4>Unstandardised results<a class="headerlink" href="#unstandardised-results" title="Permalink to this headline">#</a></h4>
<p><strong>Interpreting the coefficients</strong></p>
<p>These variables were not standardised, so the coefficients are in their original units.  The coefficients represent the change in the outcome variable, for every one unit increase in the predictor, when the value of all other predictors is held constant. It shows that the relationship remains even when you control for other variables. It does not provide evidence for/against a causal relationship. The <strong>direction of relationships is the same</strong> as in the standardised regression.</p>
<p>Examples:</p>
<ul class="simple">
<li><p><strong>Thrombolysis</strong> coefficient -0.28 means that, on average, if you had thrombolysis, you have a 0.28 improvement in mRS score between discharge and follow-up (association not causal, and of people who were followed up)</p></li>
<li><p><strong>Discharge disability</strong> coefficient -0.51 means having a one mRS score higher discharge disability associates with an improvement of 0.51 in mRS score between discharge and follow-up</p></li>
</ul>
<p><strong>Interpreting the metrics</strong></p>
<p>These are the same as the metrics when unstandardised variables were used. Why is that?</p>
<ul class="simple">
<li><p>Is it because scikit learn standardise for you anyway? No, they don’t do this, we checked the documentation and model code.</p></li>
<li><p>Is it as this is a large dataset?</p></li>
<li><p>Is it as there isn’t huge variation in scales between the variables?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Did not standardise prior to regression</span>
<span class="n">show_regression_results</span><span class="p">(</span><span class="n">reg_results_non_std</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>coef_abs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>discharge_disability</th>
      <td>-0.513378</td>
      <td>0.513378</td>
    </tr>
    <tr>
      <th>prior_disability</th>
      <td>0.328601</td>
      <td>0.328601</td>
    </tr>
    <tr>
      <th>thrombolysis</th>
      <td>-0.284410</td>
      <td>0.284410</td>
    </tr>
    <tr>
      <th>stroke_severity</th>
      <td>0.050239</td>
      <td>0.050239</td>
    </tr>
    <tr>
      <th>age</th>
      <td>0.014920</td>
      <td>0.014920</td>
    </tr>
  </tbody>
</table>
</div></div><img alt="_images/6c8dd51bf57e6e960f1cecf72ecdc88fdc751dd32ea1f72acda0eb9bf9e8f3d4.png" src="_images/6c8dd51bf57e6e960f1cecf72ecdc88fdc751dd32ea1f72acda0eb9bf9e8f3d4.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          Average MAE: 1.048270786
          Average RMSE: 1.375681834
          Average R-squared: 0.177001223
          Average adjusted R-squared: 0.177233764
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="assumptions">
<h3>Assumptions<a class="headerlink" href="#assumptions" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at relationship between actual and predicted values</span>
<span class="k">def</span> <span class="nf">test_linear</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Test assumption of linearity.</span>
<span class="sd">    df is dataframe containing columns with predicted and actual</span>
<span class="sd">    values of the response variable.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Plot actual and predicted values</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;actual&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Actual value&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predicted value&#39;</span><span class="p">)</span>

    <span class="c1"># Add diagonal line (based on overall min and max)</span>
    <span class="n">line_coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">line_coords</span><span class="p">,</span> <span class="n">line_coords</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">test_assumptions</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">reg_results</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Tests assumptions of multiple linear regression</span>
<span class="sd">    X: dataframe where each column is a predictor variable</span>
<span class="sd">    reg_results: dictionary output by regression</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Test for linear relationship between each predictor and outcome</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Linearity - look at relationship between each predictor and &#39;</span> <span class="o">+</span>
          <span class="s1">&#39;outcome - or look at</span><span class="se">\n</span><span class="s1">relationship between predicted and actual &#39;</span> <span class="o">+</span>
          <span class="s1">&#39;values (linearity indicated by even spread around diagnoal line)&#39;</span><span class="p">)</span>

    <span class="c1"># Look at linear relationship between each predictor and outcome</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Change in disability from</span><span class="se">\n</span><span class="s1">discharge to followup&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Just plot from first train/test split</span>
    <span class="n">test_linear</span><span class="p">(</span><span class="n">reg_results</span><span class="p">[</span><span class="s1">&#39;residuals&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Look at averages (if scatter not meaningful for linearity)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
        <span class="n">averages</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">averages</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Change in mRS from discharge</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                         <span class="s1">&#39;to 6-month follow-up&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Test for normally distributed residuals</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Normally distributed residuals:&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">reg_results</span><span class="p">[</span><span class="s1">&#39;residuals&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;residuals&#39;</span><span class="p">],</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Test for independent observations (just review manually)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Independent observations: review manually</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Test for homoscedasticity</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Homoscedasticity - should be no patterns in distributions of&#39;</span> <span class="o">+</span>
          <span class="s1">&#39;residuals - i.e. the size of error</span><span class="se">\n</span><span class="s1">should not relate to&#39;</span> <span class="o">+</span>
          <span class="s1">&#39;the value of the outcome variable):&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">reg_results</span><span class="p">[</span><span class="s1">&#39;residuals&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
               <span class="n">reg_results</span><span class="p">[</span><span class="s1">&#39;residuals&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">residuals</span><span class="p">,</span>
               <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Test for multicolinearity</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Multicolinearity - if there is multicolinearity present, it &#39;</span> <span class="o">+</span>
          <span class="s1">&#39;will result in less precise estimates of individual</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
          <span class="s1">&#39;regression parameters (difficult to decide precisely what&#39;</span> <span class="o">+</span>
          <span class="s1">&#39;each variable contributes) (unstable estimates, may vary</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
          <span class="s1">&#39;alot with addition or removal of data points) (larger&#39;</span> <span class="o">+</span>
          <span class="s1">&#39;sample sizes can better handle multicolinearity)&#39;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span>

    <span class="c1"># Create figure object</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

    <span class="c1"># Set colours</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span>
        <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">])</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">TwoSlopeNorm</span><span class="p">(</span><span class="n">vcenter</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Create heatmap</span>
    <span class="n">heatmap</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

    <span class="c1"># Add legend for colours</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">heatmap</span><span class="p">)</span>

    <span class="c1"># Show plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Observations:</strong></p>
<ul class="simple">
<li><p>Linearity - not really</p></li>
<li><p>Normally distributed residuals - no (slight left skew)</p></li>
<li><p>Independent observations - yes (as each row is different patient)</p></li>
<li><p>Homoscedasticity - yes, appears so</p></li>
<li><p>Multicolinearity - alright, max is 0.5, so doesn’t appear to be problematic colinearity</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_assumptions</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">reg_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Linearity - look at relationship between each predictor and outcome - or look at
relationship between predicted and actual values (linearity indicated by even spread around diagnoal line)
</pre></div>
</div>
<img alt="_images/15713569f2c39547f7f7fdec0ed2c34596986212aad75ec35618b148a0c1aee6.png" src="_images/15713569f2c39547f7f7fdec0ed2c34596986212aad75ec35618b148a0c1aee6.png" />
<img alt="_images/17dbb28d5c5e7f742baeae07243a0d98fb2b747ea6494dc6d5b8b3ec5222575c.png" src="_images/17dbb28d5c5e7f742baeae07243a0d98fb2b747ea6494dc6d5b8b3ec5222575c.png" />
<img alt="_images/b5559662f89c7ecd318f65334173afcf09092f409fc2438225686e75ba83b81c.png" src="_images/b5559662f89c7ecd318f65334173afcf09092f409fc2438225686e75ba83b81c.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normally distributed residuals:
</pre></div>
</div>
<img alt="_images/94a7b76d425744f6305ea5b38642f3a05fb974bde8cc453a6941836f2a4b2ce0.png" src="_images/94a7b76d425744f6305ea5b38642f3a05fb974bde8cc453a6941836f2a4b2ce0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Independent observations: review manually

Homoscedasticity - should be no patterns in distributions ofresiduals - i.e. the size of error
should not relate tothe value of the outcome variable):
</pre></div>
</div>
<img alt="_images/4c84d998db785396b6faaa397699a7c265d125a5f0ec325492cac5ae24099681.png" src="_images/4c84d998db785396b6faaa397699a7c265d125a5f0ec325492cac5ae24099681.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Multicolinearity - if there is multicolinearity present, it will result in less precise estimates of individual
regression parameters (difficult to decide precisely whateach variable contributes) (unstable estimates, may vary
alot with addition or removal of data points) (largersample sizes can better handle multicolinearity)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>prior_disability</th>
      <th>stroke_severity</th>
      <th>age</th>
      <th>thrombolysis</th>
      <th>discharge_disability</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>prior_disability</th>
      <td>1.00</td>
      <td>0.18</td>
      <td>0.37</td>
      <td>-0.14</td>
      <td>0.50</td>
    </tr>
    <tr>
      <th>stroke_severity</th>
      <td>0.18</td>
      <td>1.00</td>
      <td>0.08</td>
      <td>0.30</td>
      <td>0.40</td>
    </tr>
    <tr>
      <th>age</th>
      <td>0.37</td>
      <td>0.08</td>
      <td>1.00</td>
      <td>-0.08</td>
      <td>0.29</td>
    </tr>
    <tr>
      <th>thrombolysis</th>
      <td>-0.14</td>
      <td>0.30</td>
      <td>-0.08</td>
      <td>1.00</td>
      <td>-0.05</td>
    </tr>
    <tr>
      <th>discharge_disability</th>
      <td>0.50</td>
      <td>0.40</td>
      <td>0.29</td>
      <td>-0.05</td>
      <td>1.00</td>
    </tr>
  </tbody>
</table>
</div></div><img alt="_images/ee17ba9bf6fec0944fb5e9f4088072182e000aff10e2b9509b3dc93588ac9a3b.png" src="_images/ee17ba9bf6fec0944fb5e9f4088072182e000aff10e2b9509b3dc93588ac9a3b.png" />
</div>
</div>
</div>
</div>
<div class="section" id="regression-whether-have-follow-up-appointment">
<h2>Regression (whether have follow-up appointment)<a class="headerlink" href="#regression-whether-have-follow-up-appointment" title="Permalink to this headline">#</a></h2>
<p>Multiple logistic regression model.</p>
<div class="section" id="id1">
<h3>Dataset<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<p>The dataset is patients who arrived within 4 hours of known onset, and who have complete data data for discharge disability, stroke severity, age and whether thrombolysed. They can have incomplete data for 6-month follow-up (as that is what we are predicting).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract relevant columns, resetting index else set on slice</span>
<span class="n">reg_df</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;prior_disability&#39;</span><span class="p">,</span> <span class="s1">&#39;stroke_severity&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span>
               <span class="s1">&#39;thrombolysis&#39;</span><span class="p">,</span> <span class="s1">&#39;discharge_disability&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Create column of whether had follow-up</span>
<span class="n">reg_df</span><span class="p">[</span><span class="s1">&#39;6_month_complete&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;disability_6_month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="kc">False</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">:</span> <span class="mi">0</span><span class="p">}))</span>
<span class="n">display</span><span class="p">(</span><span class="n">reg_df</span><span class="p">[</span><span class="s1">&#39;6_month_complete&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="c1"># Drop NA</span>
<span class="n">reg_df</span> <span class="o">=</span> <span class="n">reg_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">reg_df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Define predictor and response variables</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">reg_df</span><span class="p">[[</span><span class="s1">&#39;prior_disability&#39;</span><span class="p">,</span> <span class="s1">&#39;stroke_severity&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span>
            <span class="s1">&#39;thrombolysis&#39;</span><span class="p">,</span> <span class="s1">&#39;discharge_disability&#39;</span><span class="p">]]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">reg_df</span><span class="p">[</span><span class="s1">&#39;6_month_complete&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    0.714149
1    0.285851
Name: 6_month_complete, dtype: float64
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(136012, 6)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">logistic_regression</span><span class="p">(</span><span class="n">standardise</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Run logistic regression with 5-fold cross-validation</span>
<span class="sd">    Can choose whether to standardise input variables or not</span>
<span class="sd">    Returns MAE, MSE, RMSE, R2, adjusted R2, feature weights and residuals</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Set up to create five training/test data splits</span>
    <span class="n">kfold</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Create empty dictionary to store results</span>
    <span class="c1"># (defaultdict so don&#39;t have to pre-define keys)</span>
    <span class="n">reg_results</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="c1"># Use loop to test model on those five different splits</span>
    <span class="k">for</span> <span class="n">train_row</span><span class="p">,</span> <span class="n">test_row</span> <span class="ow">in</span> <span class="n">kfold</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
        <span class="c1"># Split into training and test data</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_row</span><span class="p">],</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_row</span><span class="p">]</span>
        <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">train_row</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">test_row</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">standardise</span><span class="p">:</span>
            <span class="c1"># Standardise X data</span>
            <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">standardise_data</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">)</span>

        <span class="c1"># Set up and fit multiple linear regression</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

        <span class="c1"># Get feature weights</span>
        <span class="n">reg_results</span><span class="p">[</span><span class="s1">&#39;feature_weights&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>

        <span class="c1"># Get accuracy</span>
        <span class="n">reg_results</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>

        <span class="c1"># Get confusion matrix</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">reg_results</span><span class="p">[</span><span class="s1">&#39;confusion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">reg_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Predicts everything to not be a follow-up as that is majority in dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">logistic_regression</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>defaultdict(list,
            {&#39;feature_weights&#39;: [array([[ 0.05131654, -0.11633305,  0.07940351,  0.0847804 , -0.51825672]]),
              array([[ 0.04086695, -0.1211715 ,  0.07621306,  0.08606179, -0.50626478]]),
              array([[ 0.05181745, -0.11553565,  0.07634126,  0.08754673, -0.51495727]]),
              array([[ 0.05501441, -0.11034361,  0.07623767,  0.08122667, -0.51882853]]),
              array([[ 0.05058295, -0.11738322,  0.07586085,  0.08498964, -0.51801585]])],
             &#39;accuracy&#39;: 0.7101316079700022,
             &#39;confusion&#39;: array([[19309,    16],
                    [ 7869,     8]])})
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="thrombectomy.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Thrombectomy</p>
      </div>
    </a>
    <a class="right-next"
       href="ambulance.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Ambulance</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aims">Aims</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up">Set up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive">Descriptive</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#completion">Completion</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filter-to-alive-at-discharge">Filter to alive at discharge</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-patients-followed-up-with-those-not">Comparing patients followed up with those not</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#change-in-disability-between-discharge-and-6-month-follow-up">Change in disability between discharge and 6-month follow-up</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-change-in-disability">Regression (change in disability)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset">Dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transform-data-fit-model-and-collect-evaluation-metrics">Transform data, fit model, and collect evaluation metrics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#review-results">Review results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#standardised-results">Standardised results</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#unstandardised-results">Unstandardised results</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#assumptions">Assumptions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-whether-have-follow-up-appointment">Regression (whether have follow-up appointment)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Dataset</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By SAMueL-2 team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>